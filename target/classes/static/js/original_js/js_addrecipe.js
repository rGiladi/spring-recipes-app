function calc_ingrident_price(e){curr_indx=$(".product_price").index(e);var t=+e.val();known_calc_prices[curr_indx]?(add_recipe_total_price+=t-known_calc_prices[curr_indx],known_calc_prices[curr_indx]=t):(known_calc_prices[curr_indx]=t,add_recipe_total_price+=t),$("#sum").text(add_recipe_total_price)}function readURL(e){if(e.files&&e.files[0]&&e.files[0].size<48e5)if(e.files[0].type.match(/.(jpg|jpeg|png|gif)$/i)){$("#prev_img").attr("real_src",null);var t=new FileReader;t.onload=function(e){$(".btn_upload_file").hide(),$("#prev_img").attr("src",e.target.result).css("display","block")},t.readAsDataURL(e.files[0])}else resetFile();else resetFile()}function resetFile(){var e=$('input[name="file"]');toast("אפשר להעלות קבצים רק מסוג GIF, PNG, JPEG, JPG ועד 5 MB"),e.val(""),e.type="",e.type="file",0!=e[0].files.length&&(file_input.wrap("<form>").closest("form").get(0).reset(),file_input.unwrap()),0!=e[0].files.length&&e.replaceWith(e.clone(!0,!0))}function sendFile(e,t){var i=new FormData;return i.append("file",e),$.ajax({type:"POST",url:"/fileUpload",data:i,beforeSend:function(e){e.setRequestHeader("X-CSRF-TOKEN",t)},processData:!1,contentType:!1,xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){$(".progress").css("display","block"),$(".progress-bar").css("width",e.loaded/e.total*100+"%"),$(".progress-bar").attr("aria-valuenow",e.loaded/e.total*100+"%")},e}})}function updateRecipeAjaxCall(e,t,a,s){var r=getFormDataObject(a,e);$.ajax({url:s,type:"post",contentType:"application/json",data:JSON.stringify(r),beforeSend:function(e){e.setRequestHeader("X-CSRF-TOKEN",t)},success:function(e){switch(e){case"":$(".add_recipe_form")[0].reset(),window.location="/";break;case"error":toast("הייתה בעיה, נסה שוב או רענן");break;default:toast("שכחת למלא סעיפים מסויימים?");var t=e.split(", ");for(i=0;i<t.length;i++)$(t[i]).addClass("alert-danger");-1==t.indexOf(".products_col")&&$(".products_col").removeClass("alert-danger")}},xhr:function(){var e=$.ajaxSettings.xhr();return e.upload.onprogress=function(e){$(".progress").css("display","block"),$(".progress-bar").css("width",e.loaded/e.total*100+"%"),$(".progress-bar").attr("aria-valuenow",e.loaded/e.total*100+"%")},e}})}function getFormDataObject(e,t){var i={};return i.id=t,i.title=$(".add_recipe_title").val(),i.time=$(".add_recipe_preparetime").val(),i.freetext=$(".add_recipe_freetext").val(),i.amount=$(".add_recipe_amount").val(),i.price=parseFloat($("#sum").text()),i.prices=getProductsPrices(),i.products=getProducts(),i.image=null!=$("#prev_img").attr("real_src")?$("#prev_img").attr("real_src"):e,i.recipetime=$("#addrecipe_select_recipetime :selected").val(),i.recipetype=$("#addrecipe_select_recipetype :selected").val(),i.gluten=$('input[name="gluten"]').is(":checked"),i.vegetarian=$('input[name="vegetarian"]').is(":checked"),i.vegan=$('input[name="vegan"]').is(":checked"),i.kosher=$('input[name="kosher"]').is(":checked"),i.spicy=$('input[name="spicy"]').is(":checked"),i}function endValidation(){var e=$(".add_recipe_title");if(0==e.val().trim().length)return e.addClass("alert-danger"),toast("חובה למלא כותרת"),!1;if(e.val().length>120)return e.addClass("alert-danger"),toast("הכותרת צריכה להיות בין 1 ל 120 תווים"),!1;e.removeClass("alert-danger");var t=$(".add_recipe_freetext");if(t.val()>550)return t.addClass("alert-danger"),toast("הטקסט יכול להיות בין 0 ל 550 תווים"),!1;var i=$(".add_recipe_preparetime");if(!i.val()||i.val()<=0)return i.addClass("alert-danger"),toast("חובה למלא זמן הכנה"),!1;if(i.val()>2880)return i.addClass("alert-danger"),toast("זמן ההכנה צריך להיות בין 1 ל 2880 דקות (2 ימים)"),!1;i.removeClass("alert-danger");var a=$(".add_recipe_amount");if(!a.val()||a.val()<=0)return a.addClass("alert-danger"),toast("חובה למלא כמות מנות"),!1;if(a.val()>99)return a.addClass("alert-danger"),toast("הכמות צריכה להיות בין 1 ל 100 מנות"),!1;a.removeClass("alert-danger");var s=getProducts(),r=getProductsPrices();if(0==s.length||0==r.length)return toast("חובה להכניס לפחות 3 מוצרים"),$(".products_col").addClass("alert-danger"),!1;if(s.length<3||3>r)return toast("חובה להכניס לפחות 3 מוצרים"),$(".products_col").addClass("alert-danger"),!1;if($(".products_col").removeClass("alert-danger"),s.length!==r.length)return $(".products_col").addClass("alert-danger"),toast("לכל מוצר צריך למלא שם ומחיר"),!1;(0!==s.length||0!==r.length)&&$(".products_col").removeClass("alert-danger");var n=$("input[name='file']");return!n[0].files[0]&&$("#prev_img").hasClass("adding_rec")||0==$("#prev_img").attr("src").trim().length?($(".box_upload_file").addClass("alert-danger"),toast("לא העלית תמונה עדיין..."),!1):($(".box_upload_file").removeClass("alert-danger"),!0)}function getProducts(){var e=[];return $(".product_ing").each(function(){$(this).hasClass("ing_hide")||$(this).val().trim().length>0&&e.push($(this).val())}),e}function getProductsPrices(){var e=[];return $(".product_price").each(function(){$(this).val()>0&&e.push($(this).val())}),e}function ingTop(){var e=$(this).scrollTop();30>e?$(".ingridients_table").css("margin-top",30):$(".ingridients_table").css("margin-top",e)}var caret=!1;$(".addrecipe_moreoptions").on("click",function(){caret?($(this).children(".fa-caret-up").removeClass("fa-caret-up").addClass("fa-caret-down"),$(".addrecipe_options").hide(),caret=!1):($(this).children(".fa-caret-down").removeClass("fa-caret-down").addClass("fa-caret-up"),$(".addrecipe_options").show(),caret=!0)});var add_recipe_total_price=0,known_calc_prices=[],curr_indx;$(document).on("focusout",".product_price",function(){$(this).val()<1?$(this).val(""):calc_ingrident_price($(this))}),$(".add_recipe_freetext").on("keyup",function(){var e=$(".re_cha span"),t=$(this).val().length;550>t?e.text(550-$(this).val().length):(e.text(0),$(this).val($(this).val().substr(0,550)))}),$(".add_recipe_title").on("keyup",function(){var e=$(".re_cha_t span"),t=$(this).val().length;120>t?e.text(120-$(this).val().length):(e.text(0),$(this).val($(this).val().substr(0,120)))}),$(".add_recipe_preparetime").on("focusout",function(){$(this).val()>2880&&($(this).val(2880),toast("זמן ההכנה צריך להיות בין 1 ל 2880 דקות (2 ימים)"))}),$(".add_recipe_amount").on("focusout",function(){$(this).val()>100&&($(this).val(100),toast("הכמות צריכה להיות בין 1 ל 100 מנות"))}),$(".btn_upload_file").on("click",function(){$("input[name='file']").click()}),$("input[name='file']").on("change",function(){readURL(this)}),$(".add_recipe_submit").on("click",function(){var e=$(this).attr("href_id");if(endValidation()){var t=$("input[name='file']")[0].files[0],i=$('input[name="_csrf"]').val();$.when(sendFile(t,i)).then(function(t,a){if("type"!=t&&"server"!=t&&"empty"!=t&&"success"==a){{getFormDataObject(t)}updateRecipeAjaxCall(e,i,t,"/addrecipe")}switch(t){case"type":toast("אפשר להעלות קבצים רק מסוג GIF, PNG, JPEG, JPG ועד 5 MB");break;case"server":toast("הייתה שגיאה, בבקשה נסה שוב (רענון יכול לפתור את הבעיה)");break;case"empty":toast("הייתה בעיה עם העלאת התמונה")}})}}),$(".edit_recipe_submit").on("click",function(){var e=$(this).attr("href_id"),t=$('input[name="_csrf"]').val();if(endValidation())if(null==$("#prev_img").attr("real_src")){var i=$("input[name='file']")[0].files[0];$.when(sendFile(i,t)).then(function(i,a){return"type"==i||"server"==i||"empty"==i||"success"!=a?(i_name="error",!1):void updateRecipeAjaxCall(e,t,i,"/updaterecipe")})}else updateRecipeAjaxCall(e,t,"","/updaterecipe")}),$(".add_recipe_product").on("click",function(){if(0!=$(".ing_hide").length){var e=$(".ing_hide").first();e.removeClass("ing_hide").get(0).scrollIntoView(),e.find(".product_ing").focus()}else toast("עברת את כמות המוצרים המותרת")}),$("input, div").on("click",function(){$(this).hasClass("alert-danger")&&$(this).removeClass("alert-danger")}),$(".by_radio").on("click",function(){$(this).hasClass("by_amount")?($(".mmpil_price").css("display","block"),$(".mmpil_price2").css("display","none"),$(".select_by_oz").css("visibility","hidden"),$(".select_by_amount").css("visibility","visible"),$(".by_oz")[0].checked=!1,$(".mmpil_ing_by").each(function(){$(this).text($(".select_by_amount :selected").text())})):($(".mmpil_price2").css("display","block"),$(".mmpil_price").css("display","none"),$(".mmpil_ing_by").each(function(){$(this).text($(".select_by_oz :selected").text())}),$(".select_by_amount").css("visibility","hidden"),$(".select_by_oz").css("visibility","visible"),$(".by_amount")[0].checked=!1)});var last_value_by_amount=1,last_value_by_oz=1;$(".select_by").on("change",function(){var e=$(this);$(".mmpil_ing_by").each(function(){$(this).text(e.hasClass("select_by_amount")?e[0].value:e.find("option:selected").text())}),$(this).hasClass("select_by_amount")?$(".mmpil_price").each(function(){var t=$(this).text();$(this).text((t/last_value_by_amount*e[0].value).toFixed(2)),last_value_by_amount=e[0].value}):$(".mmpil_price2").each(function(){var t=$(this).text();console.log(t),$(this).text((t/last_value_by_oz*e[0].value).toFixed(2)),last_value_by_oz=e[0].value})});var ing_table_on;window.innerWidth>760?($(document).scroll(function(){ingTop()}),ing_table_on=!0):ing_table_on=!1,$(window).resize(function(){!ing_table_on&&window.innerWidth>760&&$(document).on("scroll",function(){ingTop(),ing_table_on=!0}),window.innerWidth<=760&&ing_table_on&&($(document).off("scroll"),ing_table_on=!1)});
